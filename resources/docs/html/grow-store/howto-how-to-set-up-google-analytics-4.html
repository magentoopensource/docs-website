
<h1 class="text-4xl font-bold text-charcoal mb-6">How to Set Up Google Analytics 4</h1>

<div class="flex flex-wrap items-center gap-3 mb-8">
    <span class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium bg-orange-50 text-orange-700">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        6 minutes
    </span>
    <span class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium bg-yellow-50 text-brown">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
        </svg>
        Intermediate
    </span>
    <span class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium bg-orange-50 text-orange-700">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.99 1.99 0 013 12V7a4 4 0 014-4z"/>
        </svg>
        How-To
    </span>
</div>

<section class="bg-white mb-8 p-8 border-t-4 border-yellow-500 shadow-sm">
    <h2 class="text-2xl font-bold text-charcoal mb-4 mt-0">Overview</h2>

    <div class="bg-gray-50 border-l-4 border-yellow-500 p-6 mb-6">
        <h3 class="text-lg font-bold text-charcoal mb-3">Why GA4 Enhanced Ecommerce Matters</h3>
        <ul class="space-y-2 pl-6">
            <li class="relative hexagon-bullet pl-6 text-gray-700">Track complete customer journey from product views to purchases</li>
            <li class="relative hexagon-bullet pl-6 text-gray-700">Optimize conversion rates and reduce acquisition costs</li>
            <li class="relative hexagon-bullet pl-6 text-gray-700">Build remarketing audiences for cart abandoners and high-value buyers</li>
            <li class="relative hexagon-bullet pl-6 text-gray-700">Import conversions into Google Ads for Smart Bidding optimization</li>
            <li class="relative hexagon-bullet pl-6 text-gray-700">Improve ROAS within 2-6 weeks after proper implementation</li>
        </ul>
    </div>

    <p class="text-lg text-gray-700 leading-relaxed mb-6">
        Set up Google Analytics 4 (GA4) with enhanced ecommerce tracking to see the full customer journey—from product views to purchases—so you can optimize conversion rates, reduce acquisition costs, and improve store performance. With purchase events in GA4, you can track revenue and average order value by channel, build remarketing audiences, import conversions into Google Ads for Smart Bidding, and diagnose drop-off in the product-to-checkout funnel. Many merchants see improved ROAS within 2–6 weeks after importing reliable GA4 purchase conversions into Google Ads.
    </p>

    <div class="bg-white border-4 border-yellow-500 p-4 mb-6 flex gap-3 items-start">
        <svg class="w-5 h-5 text-orange-500 flex-shrink-0 mt-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12.01" y2="8"></line>
        </svg>
        <div class="text-charcoal text-sm">
            <p class="font-bold mb-1">Version Compatibility and Path Selection</p>
            <ul class="space-y-1 pl-4">
                <li><strong>Magento 2.4.5+:</strong> Use Stores › Configuration › Sales › Google API › Google Tag to add your GA4 Measurement ID (recommended for most merchants). Do not also install GA4 via GTM unless intentionally architected to avoid duplicates.</li>
                <li><strong>Magento &lt; 2.4.5:</strong> Use Google Tag Manager (GTM) or a Marketplace extension to deploy GA4.</li>
                <li><strong>Critical:</strong> Choose a single path to avoid duplicate tags. If you must use both Google Tag and GTM, ensure only one source sends page_view and purchase.</li>
            </ul>
        </div>
    </div>
</section>

<section class="bg-white mb-8 p-8 border-t-4 border-yellow-500 shadow-sm">
    <h2 class="text-2xl font-bold text-charcoal mb-6 mt-0">Prerequisites</h2>
    <p class="text-gray-700 mb-6">Before you begin, make sure you have:</p>
    <div class="grid md:grid-cols-2 gap-4">
        <div class="relative bg-gradient-to-br from-orange-50 to-white border border-orange-500/30 p-5">
            <div class="flex items-start gap-4">
                <div class="w-10 h-10 bg-orange-500 flex items-center justify-center flex-shrink-0">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                </div>
                <div>
                    <h4 class="font-semibold text-charcoal mb-1">GA4 Property & Measurement ID</h4>
                    <p class="text-sm text-charcoal/70">A GA4 property with a Web data stream and Measurement ID (G-XXXXXXXXXX)</p>
                </div>
            </div>
        </div>
        <div class="relative bg-gradient-to-br from-yellow-50 to-white border border-yellow-500/30 p-5">
            <div class="flex items-start gap-4">
                <div class="w-10 h-10 bg-yellow-500 flex items-center justify-center flex-shrink-0">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                    </svg>
                </div>
                <div>
                    <h4 class="font-semibold text-charcoal mb-1">Magento Admin Access</h4>
                    <p class="text-sm text-charcoal/70">Access to Magento Admin Panel with appropriate scope permissions</p>
                </div>
            </div>
        </div>
        <div class="relative bg-gradient-to-br from-orange-50 to-white border border-orange-500/30 p-5">
            <div class="flex items-start gap-4">
                <div class="w-10 h-10 bg-orange-500 flex items-center justify-center flex-shrink-0">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                    </svg>
                </div>
                <div>
                    <h4 class="font-semibold text-charcoal mb-1">Development Environment (Optional)</h4>
                    <p class="text-sm text-charcoal/70">Magento development environment and deployment access for code-based implementation</p>
                </div>
            </div>
        </div>
        <div class="relative bg-gradient-to-br from-yellow-50 to-white border border-yellow-500/30 p-5">
            <div class="flex items-start gap-4">
                <div class="w-10 h-10 bg-yellow-500 flex items-center justify-center flex-shrink-0">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                    </svg>
                </div>
                <div>
                    <h4 class="font-semibold text-charcoal mb-1">Testing Environment</h4>
                    <p class="text-sm text-charcoal/70">Access to staging store and test payment method to place orders for validation</p>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="bg-white mb-8 p-8 border-t-4 border-yellow-500 shadow-sm">
    <h2 class="text-2xl font-bold text-charcoal mb-4 mt-0">What You'll Accomplish</h2>
    <p class="text-gray-700 mb-4">By following this guide, you will:</p>
    <ul class="space-y-3 pl-6">
        <li class="relative hexagon-bullet pl-6 text-gray-700">Set up Google Analytics 4 with ecommerce tracking for your Magento store, including page views and purchase events</li>
    </ul>
</section>

<div class="bg-yellow-500 border-4 border-amber-600 p-4 mb-8 flex gap-3 items-start">
    <svg class="w-6 h-6 text-amber-700 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2L1 21h22L12 2zm0 3.99L19.53 19H4.47L12 5.99zM11 16h2v2h-2v-2zm0-6h2v4h-2v-4z"/>
    </svg>
    <div>
        <p class="font-bold text-brown mb-2">Implementation Path Decision</p>
        <p class="text-brown mb-3">Before you start the steps, choose one implementation path to avoid duplicate data:</p>
        <ul class="text-brown text-sm space-y-1 pl-4">
            <li><strong>Option A (recommended for Magento 2.4.5+):</strong> Use Magento's native Google Tag (GA4) integration for a no-code install.</li>
            <li><strong>Option B:</strong> Use Google Tag Manager if you manage multiple tags or need advanced control.</li>
            <li><strong>Option C:</strong> Manual theme/module edits (developers) when Admin/GTM options are unavailable.</li>
        </ul>
        <p class="text-brown text-sm mt-2"><strong>Critical:</strong> Follow only one option or coordinate carefully to prevent duplicate events.</p>
    </div>
</div>

<h2 class="text-3xl font-bold text-charcoal mb-8">Step-by-Step Instructions</h2>

<div class="border-t-4 border-yellow-500 bg-white shadow-sm p-8 mb-6">
    <div class="flex items-center gap-4 mb-6">
        <div class="w-10 h-10 bg-yellow-500 text-charcoal font-extrabold text-lg flex items-center justify-center flex-shrink-0">0</div>
        <h3 class="text-2xl font-bold text-charcoal m-0">Create a GA4 property and web data stream</h3>
    </div>
    <div class="text-gray-700 leading-relaxed">
        <p class="text-gray-700 leading-relaxed mb-4">
            In Google Analytics, create a new GA4 property. Add a Web data stream for your storefront domain and note the Measurement ID (format: G-XXXXXXXXXX). Enable Enhanced Measurement.
        </p>
    </div>
</div>

<div class="border-t-4 border-yellow-500 bg-white shadow-sm p-8 mb-6">
    <div class="flex items-center gap-4 mb-6">
        <div class="w-10 h-10 bg-yellow-500 text-charcoal font-extrabold text-lg flex items-center justify-center flex-shrink-0">1</div>
        <h3 class="text-2xl font-bold text-charcoal m-0">Create a Google Tag Manager (GTM) Web container (recommended path)</h3>
    </div>
    <div class="text-gray-700 leading-relaxed">
        <p class="text-gray-700 leading-relaxed mb-4">
            If you plan to use GTM (Option B), in Google Tag Manager, create a new container for your domain (target type: Web). Note your container ID (format: GTM-XXXXXXX).
        </p>
        <div class="bg-white border-4 border-yellow-500 p-4 flex gap-3 items-start">
            <svg class="w-5 h-5 text-orange-500 flex-shrink-0 mt-0.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
            <p class="text-charcoal text-sm"><strong>Note:</strong> If you're on Magento 2.4.5+ and do not need GTM, you can use Magento's Google Tag integration in Step 2 instead. Avoid installing both unless you understand and prevent duplicate events.</p>
        </div>
    </div>
</div>

<div class="border-t-4 border-yellow-500 bg-white shadow-sm p-8 mb-6">
    <div class="flex items-center gap-4 mb-6">
        <div class="w-10 h-10 bg-yellow-500 text-charcoal font-extrabold text-lg flex items-center justify-center flex-shrink-0">2</div>
        <h3 class="text-2xl font-bold text-charcoal m-0">Install GTM on Magento via Admin (if available)</h3>
    </div>
    <div class="text-gray-700 leading-relaxed">
        <h4 class="font-semibold text-charcoal mb-3">For Magento 2.4.5+ (Option A: Google Tag GA4, recommended):</h4>
        <ol class="space-y-4 list-none pl-0 mb-6">
            <li class="relative pl-10">
                <span class="absolute left-0 top-0 font-semibold text-charcoal">1.</span>
                Go to <span class="step-code">Stores › Configuration</span>
            </li>
            <li class="relative pl-10">
                <span class="absolute left-0 top-0 font-semibold text-charcoal">2.</span>
                In the top-left Scope dropdown, select the Website/Store View you want to configure
            </li>
            <li class="relative pl-10">
                <span class="absolute left-0 top-0 font-semibold text-charcoal">3.</span>
                Navigate to <span class="step-code">Sales › Google API › Google Tag</span>
            </li>
            <li class="relative pl-10">
                <span class="absolute left-0 top-0 font-semibold text-charcoal">4.</span>
                Enter your GA4 Measurement ID (G-XXXXXXXXXX), enable the integration, and Save
            </li>
            <li class="relative pl-10">
                <span class="absolute left-0 top-0 font-semibold text-charcoal">5.</span>
                Go to <span class="step-code">System › Cache Management</span> and Flush Magento Cache
            </li>
        </ol>

        <div class="bg-white border-4 border-yellow-500 p-4 mb-4 flex gap-3 items-start">
            <svg class="w-5 h-5 text-orange-500 flex-shrink-0 mt-0.5" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7zm2.85 11.1l-.85.6V16h-4v-2.3l-.85-.6A4.997 4.997 0 017 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 1.63-.8 3.16-2.15 4.1z"/>
            </svg>
            <div class="text-charcoal text-sm">
                <p class="font-bold mb-1">Multi-store Configuration</p>
                <p>Configure per Website/Store View as needed. Uncheck "Use Default" to override values at lower scopes.</p>
            </div>
        </div>

        <h4 class="font-semibold text-charcoal mb-3">About GTM via Admin:</h4>
        <p class="text-gray-700 leading-relaxed">
            The legacy Google Tag Manager module is not included by default in 2.4.4+ unless installed separately. If you don't see Google Tag or GTM settings in Admin, proceed to Step 3 to add the container via your theme.
        </p>
    </div>
</div>

<div class="border-t-4 border-yellow-500 bg-white shadow-sm p-8 mb-6">
    <div class="flex items-center gap-4 mb-6">
        <div class="w-10 h-10 bg-yellow-500 text-charcoal font-extrabold text-lg flex items-center justify-center flex-shrink-0">3</div>
        <h3 class="text-2xl font-bold text-charcoal m-0">Install GTM on Magento via theme (alternative)</h3>
    </div>
    <div class="text-gray-700 leading-relaxed">
        <p class="text-gray-700 leading-relaxed mb-4">
            If your Admin lacks Google Tag or GTM settings, add the GTM snippets via theme/layout.
        </p>

        <h4 class="font-semibold text-charcoal mb-3">Head script snippet:</h4>
        <ul class="space-y-2 pl-6 mb-4">
            <li class="relative hexagon-bullet pl-6 text-gray-700"><strong>Preferred:</strong> Add the GTM <code class="step-code">&lt;script&gt;</code> to the head via <span class="step-code">Admin › Content › Design › Configuration › Edit Scope › Other Settings › HTML Head › Scripts and Style Sheets</span></li>
            <li class="relative hexagon-bullet pl-6 text-gray-700"><strong>Or in layout XML:</strong> Reference the correct container (head.additional)</li>
        </ul>

        <div class="bg-gray-50 p-4 mb-4">
            <p class="font-semibold text-charcoal mb-3">File example (app/design/frontend/&lt;Vendor&gt;/&lt;theme&gt;/Magento_Theme/layout/default.xml):</p>
            <pre class="bg-charcoal text-yellow-500 p-4 overflow-x-auto text-sm font-mono">&lt;page xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:noNamespaceSchemaLocation="urn:magento:framework:View/Layout/etc/page_configuration.xsd"&gt;
    &lt;head&gt;
        &lt;!-- Optionally include a block/template to output the GTM head script --&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;!-- See after.body.start below for the noscript iframe --&gt;
    &lt;/body&gt;
&lt;/page&gt;</pre>
        </div>

        <h4 class="font-semibold text-charcoal mb-3">Body noscript snippet (immediately after &lt;body&gt;):</h4>
        <p class="text-gray-700 mb-3">Add a block to the after.body.start container in app/design/frontend/&lt;Vendor&gt;/&lt;theme&gt;/Magento_Theme/layout/default.xml:</p>

        <div class="bg-gray-50 p-4 mb-4">
            <pre class="bg-charcoal text-yellow-500 p-4 overflow-x-auto text-sm font-mono">&lt;page xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:noNamespaceSchemaLocation="urn:magento:framework:View/Layout/etc/page_configuration.xsd"&gt;
    &lt;body&gt;
        &lt;referenceContainer name="after.body.start"&gt;
            &lt;block class="Magento\Framework\View\Element\Template"
                   name="gtm.noscript"
                   template="Magento_Theme::gtm/noscript.phtml"/&gt;
        &lt;/referenceContainer&gt;
    &lt;/body&gt;
&lt;/page&gt;</pre>
        </div>

        <div class="bg-yellow-500 border-4 border-amber-600 p-4 mb-4 flex gap-3 items-start">
            <svg class="w-6 h-6 text-amber-700 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2L1 21h22L12 2zm0 3.99L19.53 19H4.47L12 5.99zM11 16h2v2h-2v-2zm0-6h2v4h-2v-4z"/>
            </svg>
            <p class="text-brown"><strong>Important:</strong> Do not place the noscript iframe in Footer › Miscellaneous HTML; it renders at the end of &lt;body&gt;, not immediately after it.</p>
        </div>

        <h4 class="font-semibold text-charcoal mb-3">Deploy and verify:</h4>
        <p class="text-gray-700 mb-3">After making changes in production mode, deploy and clear caches:</p>
        <pre class="bg-charcoal text-yellow-500 p-4 overflow-x-auto mb-4 text-sm font-mono">bin/magento cache:clean
bin/magento cache:flush
bin/magento setup:static-content:deploy -f</pre>
        <p class="text-gray-700 leading-relaxed">
            Verify the container loads using Tag Assistant (GTM Preview).
        </p>
    </div>
</div>

<div class="border-t-4 border-yellow-500 bg-white shadow-sm p-8 mb-6">
    <div class="flex items-center gap-4 mb-6">
        <div class="w-10 h-10 bg-yellow-500 text-charcoal font-extrabold text-lg flex items-center justify-center flex-shrink-0">4</div>
        <h3 class="text-2xl font-bold text-charcoal m-0">Add a GA4 Configuration tag in GTM</h3>
    </div>
    <div class="text-gray-700 leading-relaxed">
        <p class="text-gray-700 leading-relaxed mb-4">
            In GTM, create a Tag: GA4 Configuration. Enter your Measurement ID (G-XXXXXXXXXX). Trigger: All Pages. Optionally enable "Send a page view event when this configuration loads" if you are not managing page views elsewhere.
        </p>

        <div class="bg-yellow-500 border-4 border-amber-600 p-4 mb-4 flex gap-3 items-start">
            <svg class="w-6 h-6 text-amber-700 flex-shrink-0" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2L1 21h22L12 2zm0 3.99L19.53 19H4.47L12 5.99zM11 16h2v2h-2v-2zm0-6h2v4h-2v-4z"/>
            </svg>
            <div>
                <p class="font-bold text-brown mb-1">Duplicate page_view Warning</p>
                <p class="text-brown text-sm">If GA4 is also installed via Magento Google Tag (Step 2) or you already have another GA4 Configuration tag, disable "Send a page view event when this configuration loads" in GTM or remove the duplicate install. Ensure a single source sends page_view to avoid double counting.</p>
            </div>
        </div>

        <h4 class="font-semibold text-charcoal mb-3">Consent Mode (EEA/UK):</h4>
        <p class="text-gray-700 mb-3">If you serve EEA/UK users, implement Consent Mode v2 so GA4 respects user consent. Default to denied until consent is granted, then update on acceptance. Coordinate with your CMP/cookie banner.</p>

        <div class="bg-gray-50 p-4 mb-4">
            <pre class="bg-charcoal text-yellow-500 p-4 overflow-x-auto text-sm font-mono">&lt;script&gt;
    // Default consent
    gtag('consent', 'default', {
        ad_user_data: 'denied',
        ad_personalization: 'denied',
        ad_storage: 'denied',
        analytics_storage: 'denied'
    });
    // On user consent, update to granted
    // gtag('consent', 'update', { ad_user_data: 'granted', ad_personalization: 'granted', ad_storage: 'granted', analytics_storage: 'granted' });
&lt;/script&gt;</pre>
        </div>
    </div>
</div>

<div class="border-t-4 border-yellow-500 bg-white shadow-sm p-8 mb-6">
    <div class="flex items-center gap-4 mb-6">
        <div class="w-10 h-10 bg-yellow-500 text-charcoal font-extrabold text-lg flex items-center justify-center flex-shrink-0">5</div>
        <h3 class="text-2xl font-bold text-charcoal m-0">Confirm or add a GA4-compatible ecommerce data layer</h3>
    </div>
    <div class="text-gray-700 leading-relaxed">
        <p class="text-gray-700 leading-relaxed mb-4">
            Check if your site pushes GA4-ready events (for example, view_item, add_to_cart, begin_checkout, purchase) with these minimum parameters:
        </p>
        <ul class="space-y-2 pl-6 mb-4">
            <li class="relative hexagon-bullet pl-6 text-gray-700"><strong>items:</strong> array of item objects</li>
            <li class="relative hexagon-bullet pl-6 text-gray-700"><strong>value:</strong> number (no currency symbols)</li>
            <li class="relative hexagon-bullet pl-6 text-gray-700"><strong>currency:</strong> ISO 4217 code (for example, "USD")</li>
        </ul>

        <p class="text-gray-700 leading-relaxed mb-4">
            Use GTM Preview to inspect the dataLayer. If you do not see GA4-style events, plan to:
        </p>
        <ul class="space-y-2 pl-6 mb-4">
            <li class="relative hexagon-bullet pl-6 text-gray-700">Install a GA4-ready data layer extension from Marketplace, or</li>
            <li class="relative hexagon-bullet pl-6 text-gray-700">Use the low-code purchase fallback in Step 7 and phase in more events over time</li>
        </ul>
    </div>
</div>

<div class="border-t-4 border-yellow-500 bg-white shadow-sm p-8 mb-6">
    <div class="flex items-center gap-4 mb-6">
        <div class="w-10 h-10 bg-yellow-500 text-charcoal font-extrabold text-lg flex items-center justify-center flex-shrink-0">6</div>
        <h3 class="text-2xl font-bold text-charcoal m-0">Create GA4 ecommerce event tags in GTM (if data layer is present)</h3>
    </div>
    <div class="text-gray-700 leading-relaxed">
        <p class="text-gray-700 leading-relaxed mb-4">
            For each event you detect in the dataLayer, create a GA4 Event tag and map parameters using GTM Data Layer Variables.
        </p>

        <div class="bg-gray-50 p-4 mb-4">
            <h4 class="font-semibold text-charcoal mb-3">Key GA4 Events to Implement:</h4>
            <ul class="space-y-3 pl-6">
                <li class="relative hexagon-bullet pl-6 text-gray-700">
                    <strong>view_item:</strong> trigger on product detail view; map items (array), value, currency
                </li>
                <li class="relative hexagon-bullet pl-6 text-gray-700">
                    <strong>add_to_cart:</strong> trigger on add-to-cart; map items, value, currency, quantity
                </li>
                <li class="relative hexagon-bullet pl-6 text-gray-700">
                    <strong>begin_checkout:</strong> trigger at checkout start; map items, value, currency, coupon (if present)
                </li>
                <li class="relative hexagon-bullet pl-6 text-gray-700">
                    <strong>purchase:</strong> trigger on order success; map transaction_id (unique), affiliation (for example, 'online'), value (number), tax, shipping, currency, coupon, and items array
                </li>
            </ul>
        </div>

        <p class="text-gray-700 leading-relaxed">
            Create GTM Variables (Data Layer Variable type) for each field you need to map.
        </p>
    </div>
</div>

<div class="border-t-4 border-yellow-500 bg-white shadow-sm p-8 mb-6">
    <div class="flex items-center gap-4 mb-6">
        <div class="w-10 h-10 bg-yellow-500 text-charcoal font-extrabold text-lg flex items-center justify-center flex-shrink-0">7</div>
        <h3 class="text-2xl font-bold text-charcoal m-0">Low-code fallback: add a purchase event on the success page (if no data layer)</h3>
    </div>
    <div class="text-gray-700 leading-relaxed">
        <p class="text-gray-700 leading-relaxed mb-4">
            Implement at least the purchase event to unlock revenue reporting:
        </p>

        <ul class="space-y-3 pl-6 mb-4">
            <li class="relative hexagon-bullet pl-6 text-gray-700">In your theme or a custom module, add JS on the checkout success page (handle: checkout_onepage_success)</li>
            <li class="relative hexagon-bullet pl-6 text-gray-700">Output a dataLayer push with GA4 fields using correct types and names:
                <ul class="space-y-2 pl-6 mt-2">
                    <li class="relative hexagon-bullet pl-6 text-gray-700">value, tax, shipping, price, quantity must be <strong>numbers</strong></li>
                    <li class="relative hexagon-bullet pl-6 text-gray-700">currency must be a 3-letter ISO code (for example, "USD")</li>
                    <li class="relative hexagon-bullet pl-6 text-gray-700">transaction_id must be unique per order (use the Magento increment_id)</li>
                    <li class="relative hexagon-bullet pl-6 text-gray-700">GA4 item parameters: item_id (SKU), item_name (product name), item_brand (if available), item_category, price, quantity</li>
                </ul>
            </li>
        </ul>

        <div class="bg-gray-50 p-4 mb-4">
            <p class="font-semibold text-charcoal mb-3">Example purchase event (pseudocode using Magento variables):</p>
            <pre class="bg-charcoal text-yellow-500 p-4 overflow-x-auto text-sm font-mono">&lt;script&gt;
    window.dataLayer = window.dataLayer || [];
    window.dataLayer.push({
        event: 'purchase',
        ecommerce: {
            transaction_id: '{{ order.increment_id }}',
            affiliation: 'online',
            value: {{ order.grand_total_number }},
            tax: {{ order.tax_amount_number }},
            shipping: {{ order.shipping_amount_number }},
            currency: '{{ order.currency_code }}',
            coupon: '{{ order.coupon_code }}',
            items: [
                {{#each order.items}}
                {
                    item_id: '{{ this.sku }}',
                    item_name: '{{ this.name }}',
                    item_brand: '{{ this.brand }}',
                    item_category: '{{ this.category }}',
                    price: {{ this.price_number }},
                    quantity: {{ this.qty_number }}
                }{{#unless @last}},{{/unless}}
                {{/each}}
            ]
        }
    });
&lt;/script&gt;</pre>
        </div>

        <p class="text-gray-700 leading-relaxed">
            Then in GTM, create a GA4 Event tag 'purchase' triggered when event equals purchase, mapping the parameters accordingly. Clear caches and test.
        </p>
    </div>
</div>

<div class="border-t-4 border-yellow-500 bg-white shadow-sm p-8 mb-6">
    <div class="flex items-center gap-4 mb-6">
        <div class="w-10 h-10 bg-yellow-500 text-charcoal font-extrabold text-lg flex items-center justify-center flex-shrink-0">8</div>
        <h3 class="text-2xl font-bold text-charcoal m-0">Prevent duplicate purchase events</h3>
    </div>
    <div class="text-gray-700 leading-relaxed">
        <p class="text-gray-700 leading-relaxed mb-4">
            Ensure the purchase code runs only on the initial load of the success page and not on refresh or back navigation. Use a server-rendered flag or a client-side sessionStorage/localStorage key to guard against duplicates. Verify only one GTM or GA4 configuration is installed to avoid double firing.
        </p>
    </div>
</div>

<div class="border-t-4 border-yellow-500 bg-white shadow-sm p-8 mb-6">
    <div class="flex items-center gap-4 mb-6">
        <div class="w-10 h-10 bg-yellow-500 text-charcoal font-extrabold text-lg flex items-center justify-center flex-shrink-0">9</div>
        <h3 class="text-2xl font-bold text-charcoal m-0">Preview, publish, and test</h3>
    </div>
    <div class="text-gray-700 leading-relaxed">
        <p class="text-gray-700 leading-relaxed mb-4">
            Use GTM Preview (Tag Assistant) and navigate a full flow: Home › Product page (view_item) › Add to Cart (add_to_cart) › Checkout start (begin_checkout) › Order success (purchase).
        </p>

        <ul class="space-y-3 pl-6 mb-4">
            <li class="relative hexagon-bullet pl-6 text-gray-700">Confirm GA4 tags fire with correct parameters at each step</li>
            <li class="relative hexagon-bullet pl-6 text-gray-700">Validate that only one page_view and one purchase fire per order</li>
            <li class="relative hexagon-bullet pl-6 text-gray-700">Publish the container when satisfied</li>
        </ul>
    </div>
</div>

<div class="border-t-4 border-yellow-500 bg-white shadow-sm p-8 mb-6">
    <div class="flex items-center gap-4 mb-6">
        <div class="w-10 h-10 bg-yellow-500 text-charcoal font-extrabold text-lg flex items-center justify-center flex-shrink-0">10</div>
        <h3 class="text-2xl font-bold text-charcoal m-0">Validate in GA4</h3>
    </div>
    <div class="text-gray-700 leading-relaxed">
        <p class="text-gray-700 leading-relaxed mb-4">
            Open GA4 DebugView to confirm events and parameters in real time. Check Real-time for active users and event names. After 24–48 hours, review Monetization › E-commerce purchases and funnel reports for revenue, items, and conversion steps. Confirm transaction_id uniqueness and expected revenue totals.
        </p>
    </div>
</div>

<div class="border-t-4 border-yellow-500 bg-white shadow-sm p-8 mb-6">
    <div class="flex items-center gap-4 mb-6">
        <div class="w-10 h-10 bg-yellow-500 text-charcoal font-extrabold text-lg flex items-center justify-center flex-shrink-0">11</div>
        <h3 class="text-2xl font-bold text-charcoal m-0">Document and operationalize</h3>
    </div>
    <div class="text-gray-700 leading-relaxed">
        <p class="text-gray-700 leading-relaxed mb-4">
            Record your Measurement ID, container ID, and the events implemented. Note any exclusions (for example, missing view_item_list). Define ownership: assign a Marketing Operations owner for GTM/GA4. Create a monthly QA checklist (for example, verify purchase volume, revenue, item counts) and alerts for sudden drops in purchase events. Schedule periodic QA after theme/extension updates and plan the next events if you used the low-code fallback.
        </p>

        <div class="bg-white border-4 border-yellow-500 p-4 flex gap-3 items-start">
            <svg class="w-5 h-5 text-orange-500 flex-shrink-0 mt-0.5" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7zm2.85 11.1l-.85.6V16h-4v-2.3l-.85-.6A4.997 4.997 0 017 9c0-2.76 2.24-5 5-5s5 2.24 5 5c0 1.63-.8 3.16-2.15 4.1z"/>
            </svg>
            <div class="text-charcoal text-sm">
                <p class="font-bold mb-1">Google Ads Integration</p>
                <p>After events fire reliably, link GA4 to Google Ads (GA4 › Admin › Product Links › Google Ads) and import conversions (purchase) into Google Ads for optimized bidding. Ensure consistent currency and conversion window settings.</p>
            </div>
        </div>
    </div>
</div>

<h2 class="text-3xl font-bold text-charcoal mb-6">Verification</h2>
<p class="text-gray-700 mb-6">Use this checklist to confirm everything is working correctly:</p>

<ul class="list-none my-8 pl-0 space-y-5">
    <li class="bg-white p-7 shadow-sm">
        <div class="flex items-center justify-between mb-5">
            <strong class="text-lg font-bold text-charcoal">Tag Assistant (GTM Preview)</strong>
        </div>
        <ul class="grid gap-3 m-0 p-0 list-none">
            <li class="flex items-start gap-3 p-3 pl-10 bg-gray-50 hover:bg-orange-50 transition-colors relative">
                <span class="absolute left-3 top-3 w-5 h-5 border-2 border-yellow-500 flex items-center justify-center text-yellow-500 font-bold text-sm">✓</span>
                Start a preview session and navigate: Home › PDP › Add to Cart › Checkout › Success
            </li>
            <li class="flex items-start gap-3 p-3 pl-10 bg-gray-50 hover:bg-orange-50 transition-colors relative">
                <span class="absolute left-3 top-3 w-5 h-5 border-2 border-yellow-500 flex items-center justify-center text-yellow-500 font-bold text-sm">✓</span>
                GA4 tags fire on expected events (view_item, add_to_cart, begin_checkout, purchase) with items, value (number), currency (ISO), and transaction_id
            </li>
            <li class="flex items-start gap-3 p-3 pl-10 bg-gray-50 hover:bg-orange-50 transition-colors relative">
                <span class="absolute left-3 top-3 w-5 h-5 border-2 border-yellow-500 flex items-center justify-center text-yellow-500 font-bold text-sm">✓</span>
                Only one page_view per page and a single purchase per order
            </li>
        </ul>
    </li>

    <li class="bg-white p-7 shadow-sm">
        <div class="flex items-center justify-between mb-5">
            <strong class="text-lg font-bold text-charcoal">GA4 DebugView</strong>
        </div>
        <ul class="grid gap-3 m-0 p-0 list-none">
            <li class="flex items-start gap-3 p-3 pl-10 bg-gray-50 hover:bg-orange-50 transition-colors relative">
                <span class="absolute left-3 top-3 w-5 h-5 border-2 border-yellow-500 flex items-center justify-center text-yellow-500 font-bold text-sm">✓</span>
                Events appear in order with correct parameters (GA4 › Admin › DebugView)
            </li>
        </ul>
    </li>

    <li class="bg-white p-7 shadow-sm">
        <div class="flex items-center justify-between mb-5">
            <strong class="text-lg font-bold text-charcoal">Reports (after 24–48 hours)</strong>
        </div>
        <ul class="grid gap-3 m-0 p-0 list-none">
            <li class="flex items-start gap-3 p-3 pl-10 bg-gray-50 hover:bg-orange-50 transition-colors relative">
                <span class="absolute left-3 top-3 w-5 h-5 border-2 border-yellow-500 flex items-center justify-center text-yellow-500 font-bold text-sm">✓</span>
                Monetization › E-commerce purchases shows orders and item data
            </li>
            <li class="flex items-start gap-3 p-3 pl-10 bg-gray-50 hover:bg-orange-50 transition-colors relative">
                <span class="absolute left-3 top-3 w-5 h-5 border-2 border-yellow-500 flex items-center justify-center text-yellow-500 font-bold text-sm">✓</span>
                Revenue aligns with your store (within expected variance)
            </li>
        </ul>
    </li>

    <li class="bg-white p-7 shadow-sm">
        <div class="flex items-center justify-between mb-5">
            <strong class="text-lg font-bold text-charcoal">Multi-store Configuration</strong>
        </div>
        <ul class="grid gap-3 m-0 p-0 list-none">
            <li class="flex items-start gap-3 p-3 pl-10 bg-gray-50 hover:bg-orange-50 transition-colors relative">
                <span class="absolute left-3 top-3 w-5 h-5 border-2 border-yellow-500 flex items-center justify-center text-yellow-500 font-bold text-sm">✓</span>
                Correct Measurement ID/GTM container per Website/Store View
            </li>
            <li class="flex items-start gap-3 p-3 pl-10 bg-gray-50 hover:bg-orange-50 transition-colors relative">
                <span class="absolute left-3 top-3 w-5 h-5 border-2 border-yellow-500 flex items-center justify-center text-yellow-500 font-bold text-sm">✓</span>
                "Use Default" overridden where required
            </li>
        </ul>
    </li>

    <li class="bg-white p-7 shadow-sm">
        <div class="flex items-center justify-between mb-5">
            <strong class="text-lg font-bold text-charcoal">Duplicate Detection</strong>
        </div>
        <ul class="grid gap-3 m-0 p-0 list-none">
            <li class="flex items-start gap-3 p-3 pl-10 bg-gray-50 hover:bg-orange-50 transition-colors relative">
                <span class="absolute left-3 top-3 w-5 h-5 border-2 border-yellow-500 flex items-center justify-center text-yellow-500 font-bold text-sm">✓</span>
                Refreshing the success page does not create a second purchase event
            </li>
        </ul>
    </li>
</ul>

<h2 class="text-3xl font-bold text-charcoal mb-6">Common Issues and Solutions</h2>

<div class="space-y-4 my-8">
    <div class="bg-white shadow-md overflow-hidden border-t-4 border-orange-500">
        <button class="w-full p-5 text-left cursor-pointer grid grid-cols-[1fr_auto] gap-4 items-center hover:bg-orange-50 transition-colors" onclick="this.nextElementSibling.classList.toggle('hidden'); this.querySelector('svg').classList.toggle('rotate-180')">
            <div>
                <h3 class="text-xl font-bold text-charcoal mb-1">Duplicate page views or purchases</h3>
                <p class="text-charcoal/60 text-sm">Events firing twice causing inflated metrics</p>
            </div>
            <svg class="w-8 h-8 text-charcoal/50 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
        </button>
        <div class="hidden border-t border-orange-500/30">
            <div class="p-6">
                <h4 class="font-bold text-charcoal mb-3">Solution</h4>
                <ul class="list-none p-0 space-y-2">
                    <li class="relative pl-7 py-1 text-charcoal">
                        <span class="absolute left-1.5 top-3.5 w-2 h-2 bg-orange-500 rounded-full"></span>
                        Ensure only one GA4 configuration is installed
                    </li>
                    <li class="relative pl-7 py-1 text-charcoal">
                        <span class="absolute left-1.5 top-3.5 w-2 h-2 bg-orange-500 rounded-full"></span>
                        In GTM, disable the auto page_view if Magento Google Tag also sends page_view
                    </li>
                    <li class="relative pl-7 py-1 text-charcoal">
                        <span class="absolute left-1.5 top-3.5 w-2 h-2 bg-orange-500 rounded-full"></span>
                        Guard success page code with a one-time flag (for example, sessionStorage key)
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="bg-white shadow-md overflow-hidden border-t-4 border-orange-500">
        <button class="w-full p-5 text-left cursor-pointer grid grid-cols-[1fr_auto] gap-4 items-center hover:bg-orange-50 transition-colors" onclick="this.nextElementSibling.classList.toggle('hidden'); this.querySelector('svg').classList.toggle('rotate-180')">
            <div>
                <h3 class="text-xl font-bold text-charcoal mb-1">No events in DebugView</h3>
                <p class="text-charcoal/60 text-sm">GA4 DebugView shows no activity despite test transactions</p>
            </div>
            <svg class="w-8 h-8 text-charcoal/50 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
        </button>
        <div class="hidden border-t border-orange-500/30">
            <div class="p-6">
                <h4 class="font-bold text-charcoal mb-3">Solution</h4>
                <ul class="list-none p-0 space-y-2">
                    <li class="relative pl-7 py-1 text-charcoal">
                        <span class="absolute left-1.5 top-3.5 w-2 h-2 bg-orange-500 rounded-full"></span>
                        Check that the GTM container is published and not blocked by consent
                    </li>
                    <li class="relative pl-7 py-1 text-charcoal">
                        <span class="absolute left-1.5 top-3.5 w-2 h-2 bg-orange-500 rounded-full"></span>
                        Verify dataLayer event names and that GTM triggers match them
                    </li>
                    <li class="relative pl-7 py-1 text-charcoal">
                        <span class="absolute left-1.5 top-3.5 w-2 h-2 bg-orange-500 rounded-full"></span>
                        Use browser console to inspect window.dataLayer array
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="bg-white shadow-md overflow-hidden border-t-4 border-yellow-500">
        <button class="w-full p-5 text-left cursor-pointer grid grid-cols-[1fr_auto] gap-4 items-center hover:bg-yellow-50 transition-colors" onclick="this.nextElementSibling.classList.toggle('hidden'); this.querySelector('svg').classList.toggle('rotate-180')">
            <div>
                <h3 class="text-xl font-bold text-charcoal mb-1">Wrong revenue or currency</h3>
                <p class="text-charcoal/60 text-sm">Revenue values incorrect or currency mismatch in reports</p>
            </div>
            <svg class="w-8 h-8 text-charcoal/50 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
        </button>
        <div class="hidden border-t border-yellow-500/30">
            <div class="p-6">
                <h4 class="font-bold text-charcoal mb-3">Solution</h4>
                <ul class="list-none p-0 space-y-2">
                    <li class="relative pl-7 py-1 text-charcoal">
                        <span class="absolute left-1.5 top-3.5 w-2 h-2 bg-yellow-500 rounded-full"></span>
                        Ensure value is numeric (no strings) and currency is a 3-letter ISO code
                    </li>
                    <li class="relative pl-7 py-1 text-charcoal">
                        <span class="absolute left-1.5 top-3.5 w-2 h-2 bg-yellow-500 rounded-full"></span>
                        Align value with your reporting preference (incl./excl. tax)
                    </li>
                    <li class="relative pl-7 py-1 text-charcoal">
                        <span class="absolute left-1.5 top-3.5 w-2 h-2 bg-yellow-500 rounded-full"></span>
                        Validate data types in dataLayer using browser console
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="bg-white shadow-md overflow-hidden border-t-4 border-yellow-500">
        <button class="w-full p-5 text-left cursor-pointer grid grid-cols-[1fr_auto] gap-4 items-center hover:bg-yellow-50 transition-colors" onclick="this.nextElementSibling.classList.toggle('hidden'); this.querySelector('svg').classList.toggle('rotate-180')">
            <div>
                <h3 class="text-xl font-bold text-charcoal mb-1">Missing items</h3>
                <p class="text-charcoal/60 text-sm">Products not showing in GA4 ecommerce reports</p>
            </div>
            <svg class="w-8 h-8 text-charcoal/50 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
        </button>
        <div class="hidden border-t border-yellow-500/30">
            <div class="p-6">
                <h4 class="font-bold text-charcoal mb-3">Solution</h4>
                <ul class="list-none p-0 space-y-2">
                    <li class="relative pl-7 py-1 text-charcoal">
                        <span class="absolute left-1.5 top-3.5 w-2 h-2 bg-yellow-500 rounded-full"></span>
                        Confirm the items array exists and each object includes item_id and item_name at minimum
                    </li>
                    <li class="relative pl-7 py-1 text-charcoal">
                        <span class="absolute left-1.5 top-3.5 w-2 h-2 bg-yellow-500 rounded-full"></span>
                        Use GTM Preview to inspect items array structure in dataLayer
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="bg-white shadow-md overflow-hidden border-t-4 border-charcoal">
        <button class="w-full p-5 text-left cursor-pointer grid grid-cols-[1fr_auto] gap-4 items-center hover:bg-off-white transition-colors" onclick="this.nextElementSibling.classList.toggle('hidden'); this.querySelector('svg').classList.toggle('rotate-180')">
            <div>
                <h3 class="text-xl font-bold text-charcoal mb-1">Multi-store mix-ups</h3>
                <p class="text-charcoal/60 text-sm">Wrong Measurement ID or container used for different store views</p>
            </div>
            <svg class="w-8 h-8 text-charcoal/50 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
        </button>
        <div class="hidden border-t border-charcoal/20">
            <div class="p-6">
                <h4 class="font-bold text-charcoal mb-3">Solution</h4>
                <ul class="list-none p-0 space-y-2">
                    <li class="relative pl-7 py-1 text-charcoal">
                        <span class="absolute left-1.5 top-3.5 w-2 h-2 bg-charcoal rounded-full"></span>
                        Verify the correct store view scope is selected in Admin
                    </li>
                    <li class="relative pl-7 py-1 text-charcoal">
                        <span class="absolute left-1.5 top-3.5 w-2 h-2 bg-charcoal rounded-full"></span>
                        Ensure you're using the correct Measurement ID/container per store
                    </li>
                    <li class="relative pl-7 py-1 text-charcoal">
                        <span class="absolute left-1.5 top-3.5 w-2 h-2 bg-charcoal rounded-full"></span>
                        Use separate GA4 properties for distinct brands/domains
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<style>
/* Hexagon bullet marker for lists */
.hexagon-bullet::before {
    content: "";
    position: absolute;
    left: 0;
    top: 0.5em;
    width: 9px;
    height: 9px;
    background-image: url("data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12 2L21 7V17L12 22L3 17V7L12 2Z' stroke='%23F26423' stroke-width='2.5' stroke-linejoin='miter'/%3E%3C/svg%3E");
    background-size: contain;
    background-repeat: no-repeat;
}

/* Step code styling for inline code paths */
.step-code {
    background: #2C2C2C;
    color: #F1BC1B;
    padding: 0.25rem 0.5rem;
    font-family: 'Courier New', monospace;
    font-size: 0.875rem;
}
</style>
