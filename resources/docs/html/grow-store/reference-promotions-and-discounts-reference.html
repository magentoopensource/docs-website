
<h1 class="text-4xl font-bold text-charcoal mb-6">Promotions and Discounts Reference</h1>

<div class="flex flex-wrap items-center gap-3 mb-8">
    <span class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium bg-orange-50 text-orange-700">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
        45-60 minutes
    </span>
    <span class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium bg-yellow-50 text-brown">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
        </svg>
        Intermediate
    </span>
    <span class="inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium bg-orange-50 text-orange-700">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
        </svg>
        Reference
    </span>
</div>

<!-- ============================================== -->
<!-- SECTION: Overview (Featured Boxout Style) -->
<!-- ============================================== -->
<section class="bg-white mb-8 p-8 border-t-4 border-yellow-500 shadow-sm">
    <h2 class="text-2xl font-bold text-charcoal mb-4 mt-0">Overview</h2>
    <p class="text-lg text-gray-700 leading-relaxed mb-6">
        Use Magento 2 promotions to drive conversion, average order value (AOV), and retention. This reference covers Cart Price Rules (checkout discounts), Catalog Price Rules (pre-cart price adjustments), coupons, free shipping, labels, and measurement. Applies to: Magento Open Source and Adobe Commerce 2.4.x; Adobe Commerce-only features are flagged. This page is a living reference and is updated regularly to reflect the latest capabilities.
    </p>
    <p class="text-gray-700 leading-relaxed">
        Cart Price Rules apply discounts at checkout and can use coupons. Catalog Price Rules adjust product prices before the cart and do not use coupons.
    </p>
</section>

<!-- ============================================== -->
<!-- SECTION: Promotion Types at a Glance -->
<!-- ============================================== -->
<section class="mb-10">
    <h2 class="text-2xl font-bold text-charcoal mb-6">Promotion Types at a Glance</h2>

    <ul class="space-y-3 mb-6">
        <li class="relative pl-8 text-gray-700 leading-relaxed hexagon-bullet"><strong class="text-charcoal">Cart Price Rules</strong> (Open Source and Adobe Commerce): Discounts at checkout; supports coupons.</li>
        <li class="relative pl-8 text-gray-700 leading-relaxed hexagon-bullet"><strong class="text-charcoal">Catalog Price Rules</strong> (Open Source and Adobe Commerce): Pre-cart pricing adjustments; no coupon codes.</li>
        <li class="relative pl-8 text-gray-700 leading-relaxed hexagon-bullet"><strong class="text-charcoal">Free Shipping via rule</strong> (Open Source and Adobe Commerce): Use Cart Price Rule "Free Shipping" action.</li>
        <li class="relative pl-8 text-gray-700 leading-relaxed hexagon-bullet"><strong class="text-charcoal">Coupon Auto-Generation</strong> (Open Source and Adobe Commerce): In Cart Price Rules, set Coupon = Specific Coupon and Use Auto Generation = Yes, Save the rule, then reopen and click Manage Coupon Codes.</li>
        <li class="relative pl-8 text-gray-700 leading-relaxed hexagon-bullet"><strong class="text-charcoal">Scheduled Updates/Staging</strong> (Adobe Commerce only): Time-based versions of rules.</li>
        <li class="relative pl-8 text-gray-700 leading-relaxed hexagon-bullet"><strong class="text-charcoal">Gift Cards</strong> (Adobe Commerce only): Create gift card products at Catalog &gt; Products &gt; Add Product &gt; Gift Card. Manage balances at Marketing &gt; Gift Card Accounts. Tip: Most merchants exclude gift card products from discounts via Cart Price Rule Actions &gt; Conditions.</li>
        <li class="relative pl-8 text-gray-700 leading-relaxed hexagon-bullet"><strong class="text-charcoal">Customer Segments</strong> (Adobe Commerce only): Target promotions by segment.</li>
    </ul>

    <div class="bg-white border-4 border-yellow-500 p-6">
        <div class="flex gap-4 items-start">
            <div class="flex-shrink-0 w-8 h-8">
                <svg class="w-full h-full text-orange-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="16" x2="12" y2="12"></line>
                    <line x1="12" y1="8" x2="12.01" y2="8"></line>
                </svg>
            </div>
            <div class="flex-1">
                <p class="font-bold text-charcoal mb-3">Edition differences</p>
                <ul class="space-y-2 text-gray-700">
                    <li class="relative pl-8 hexagon-bullet"><strong>Open Source and Adobe Commerce:</strong> Cart Price Rules, Catalog Price Rules, Coupons, rule-based Free Shipping.</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Adobe Commerce only:</strong> Scheduled Updates/Staging, Customer Segments, Gift Cards.</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Adobe Commerce B2B:</strong> Shared Catalog custom prices are considered alongside Catalog Price Rules; the storefront uses the lowest applicable price (custom price vs. rule-adjusted price). Test with each Shared Catalog and customer group.</li>
                </ul>
            </div>
        </div>
    </div>
</section>

<!-- ============================================== -->
<!-- SECTION: Choose the Right Promotion -->
<!-- ============================================== -->
<section class="mb-10">
    <h2 class="text-2xl font-bold text-charcoal mb-6">Choose the right promotion for your goal</h2>

    <div class="space-y-4">
        <div class="bg-white border-l-4 border-yellow-500 p-6 shadow-sm">
            <p class="font-bold text-charcoal mb-2">Increase first purchase conversion</p>
            <p class="text-gray-700 leading-relaxed mb-2">Cart Price Rule with Specific Coupon for new customers; limit Uses per Customer = 1.</p>
            <p class="text-gray-700 text-sm leading-relaxed"><strong>Business note:</strong> Drives conversion but watch discount depth to protect margin.</p>
        </div>

        <div class="bg-white border-l-4 border-yellow-500 p-6 shadow-sm">
            <p class="font-bold text-charcoal mb-3">Boost AOV</p>
            <ul class="space-y-2 text-gray-700 text-sm">
                <li class="relative pl-8 hexagon-bullet">Set a threshold 10–20% above current AOV. Example: AOV $80 → threshold about $90.</li>
                <li class="relative pl-8 hexagon-bullet">Use a percent discount (e.g., 10%).</li>
                <li class="relative pl-8 hexagon-bullet">Optionally add Free Shipping for qualifying carts.</li>
                <li class="relative pl-8 hexagon-bullet">A/B test two thresholds for 7 days and pick the higher net-margin result.</li>
            </ul>
            <p class="text-gray-700 text-sm leading-relaxed mt-2"><strong>Business note:</strong> Typically increases revenue per order; validate gross margin after discount and shipping subsidies.</p>
        </div>

        <div class="bg-white border-l-4 border-orange-500 p-6 shadow-sm">
            <p class="font-bold text-charcoal mb-2">Move aging inventory</p>
            <p class="text-gray-700 leading-relaxed mb-2">Catalog Price Rule targeting category/attribute for a fixed period.</p>
            <p class="text-gray-700 text-sm leading-relaxed"><strong>Business note:</strong> Moves overstock; monitor sell-through and margin.</p>
        </div>

        <div class="bg-white border-l-4 border-yellow-500 p-6 shadow-sm">
            <p class="font-bold text-charcoal mb-2">Reward loyalty/VIPs</p>
            <p class="text-gray-700 leading-relaxed mb-2">Cart Price Rule scoped to selected Customer Groups.</p>
            <p class="text-gray-700 text-sm leading-relaxed"><strong>Business note:</strong> Improves retention and LTV; keep offers targeted.</p>
        </div>

        <div class="bg-white border-l-4 border-orange-500 p-6 shadow-sm">
            <p class="font-bold text-charcoal mb-2">Stimulate multi-unit purchase</p>
            <p class="text-gray-700 leading-relaxed mb-2">Buy X get Y (BXGY) Cart Price Rule limited to specific SKUs/categories.</p>
            <p class="text-gray-700 text-sm leading-relaxed"><strong>Business note:</strong> Increases units/order and clears specific lines; monitor gross margin per order.</p>
        </div>

        <div class="bg-white border-l-4 border-charcoal p-6 shadow-sm">
            <p class="font-bold text-charcoal mb-2">B2B (Adobe Commerce)</p>
            <p class="text-gray-700 leading-relaxed mb-2">Shared Catalog custom prices are considered alongside Catalog Price Rules; the storefront uses the lowest applicable price. Test with each Shared Catalog and customer group.</p>
            <p class="text-gray-700 text-sm leading-relaxed"><strong>Business note:</strong> Ensures negotiated pricing remains competitive; verify rule outcomes per account.</p>
        </div>
    </div>
</section>

<!-- ============================================== -->
<!-- SECTION: Configuration -->
<!-- ============================================== -->
<section class="mb-10">
    <h2 class="text-2xl font-bold text-charcoal mb-6">Configuration</h2>

    <p class="text-gray-700 mb-4">Quick navigation:</p>
    <div class="bg-white shadow-sm p-6 mb-8">
        <ul class="grid md:grid-cols-2 gap-2">
            <li><a href="#prerequisites" class="text-orange-500 hover:underline">Prerequisites</a></li>
            <li><a href="#cart-price-rules" class="text-orange-500 hover:underline">Cart Price Rules</a></li>
            <li><a href="#catalog-price-rules" class="text-orange-500 hover:underline">Catalog Price Rules</a></li>
            <li><a href="#coupons" class="text-orange-500 hover:underline">Coupons</a></li>
            <li><a href="#labels-store-views" class="text-orange-500 hover:underline">Labels and Store Views</a></li>
            <li><a href="#best-practice-guardrails" class="text-orange-500 hover:underline">Best-practice guardrails</a></li>
            <li><a href="#test-verify" class="text-orange-500 hover:underline">Test and Verify</a></li>
            <li><a href="#reporting-measurement" class="text-orange-500 hover:underline">Reporting and Measurement</a></li>
            <li><a href="#api-quick-reference" class="text-orange-500 hover:underline">API Quick Reference</a></li>
            <li><a href="#troubleshooting" class="text-orange-500 hover:underline">Troubleshooting</a></li>
            <li><a href="#promotion-recipes" class="text-orange-500 hover:underline">Promotion recipes</a></li>
        </ul>
    </div>

    <!-- Prerequisites -->
    <div class="border-t-4 border-yellow-500 bg-white shadow-sm p-8 mb-6" id="prerequisites">
        <h3 class="text-xl font-bold text-charcoal mb-4">Prerequisites</h3>

        <ul class="space-y-3 mb-6">
            <li class="relative pl-8 text-gray-700 leading-relaxed hexagon-bullet">Cron enabled and running (required for applying/scheduling Catalog Price Rules and some background tasks).</li>
            <li class="relative pl-8 text-gray-700 leading-relaxed hexagon-bullet">Indexers healthy; production sites should use Update by Schedule. CLI checks: <span class="step-code">bin/magento indexer:status</span> (to check status) and <span class="step-code">bin/magento indexer:show-mode</span> (to confirm update mode).</li>
            <li class="relative pl-8 text-gray-700 leading-relaxed hexagon-bullet">Catalog Price Scope: <span class="step-code">Stores &gt; Configuration &gt; Catalog &gt; Catalog &gt; Price &gt; Catalog Price Scope</span> (Global or Website). For multi-website setups with different prices/currencies, set to Website and test Catalog Rules per website.</li>
            <li class="relative pl-8 text-gray-700 leading-relaxed hexagon-bullet">Permissions: User role with access to <span class="step-code">Marketing &gt; Promotions &gt; Cart Price Rules</span> and <span class="step-code">Catalog Price Rules</span>.</li>
        </ul>

        <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4">
            <p class="font-semibold text-charcoal mb-2">For Free Shipping promotions</p>
            <ol class="space-y-2 list-none pl-0 text-gray-700 text-sm">
                <li class="relative pl-8 hexagon-bullet">Go to <span class="step-code">Stores &gt; Configuration &gt; Sales &gt; Shipping Methods &gt; Free Shipping</span></li>
                <li class="relative pl-8 hexagon-bullet">Set Enable = Yes</li>
                <li class="relative pl-8 hexagon-bullet">Keep your normal Minimum Order Amount in place. When a Cart Price Rule grants Free Shipping, the Free Shipping method will be offered even if the Minimum Order Amount is higher. Do not set this to 0 unless you intend to offer free shipping on all orders.</li>
                <li class="relative pl-8 hexagon-bullet">Save config and clear cache</li>
                <li class="relative pl-8 hexagon-bullet">Then, in the Cart Price Rule, set Free Shipping = "For shipment with matching items" (or "For matching items only" as needed)</li>
                <li class="relative pl-8 hexagon-bullet">Note: Many third‑party carrier methods ignore Magento's free-shipping flag. If you use external carrier integrations, test that the Free Shipping method appears and is selected as expected.</li>
                <li class="relative pl-8 hexagon-bullet">Note: "Apply to Shipping Amount" includes shipping in the discount calculation; it does not make shipping free. To make shipping free, set Actions &gt; Free Shipping and enable the Free Shipping carrier.</li>
            </ol>
        </div>
    </div>

    <!-- Cart Price Rules -->
    <div class="border-t-4 border-yellow-500 bg-white shadow-sm p-8 mb-6" id="cart-price-rules">
        <h3 class="text-xl font-bold text-charcoal mb-4">Cart Price Rules (Admin)</h3>
        <p class="text-gray-700 mb-4"><strong>Path:</strong> <span class="step-code">Admin &gt; Marketing &gt; Promotions &gt; Cart Price Rules &gt; Add New Rule</span></p>

        <div class="space-y-6">
            <div>
                <p class="font-semibold text-charcoal mb-3">1) Rule Information</p>
                <ul class="space-y-2 text-gray-700 text-sm">
                    <li class="relative pl-8 hexagon-bullet"><strong>Rule Name:</strong> [e.g., 10% off over $100]</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Description:</strong> [internal notes]</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Websites:</strong> [select]</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Customer Groups:</strong> [e.g., NOT LOGGED IN, General]</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Coupon:</strong> Select "No Coupon" or "Specific Coupon". If "Specific Coupon", enter Coupon Code. Set Use Auto Generation = Yes to mass-generate codes.</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Uses per Coupon / Uses per Customer:</strong> [enter limits]</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>From/To:</strong> Date-only (inclusive). Time-of-day scheduling is not supported here; use Scheduled Updates (Adobe Commerce) for start/end times.</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Priority:</strong> [lower number = higher priority]</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Public in RSS Feed:</strong> [Yes/No] (visible only if RSS is enabled at <span class="step-code">Stores &gt; Configuration &gt; Catalog &gt; RSS Feeds</span>)</li>
                </ul>
            </div>

            <div>
                <p class="font-semibold text-charcoal mb-3">2) Conditions</p>
                <p class="text-gray-700 text-sm">Define cart conditions (e.g., Subtotal greater than 100). Conditions must be true for the rule to trigger.</p>
            </div>

            <div>
                <p class="font-semibold text-charcoal mb-3">3) Actions</p>
                <ul class="space-y-2 text-gray-700 text-sm">
                    <li class="relative pl-8 hexagon-bullet"><strong>Apply:</strong> [Percent of product price discount | Fixed amount discount | Fixed amount discount for whole cart | Buy X get Y]</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Discount Amount:</strong> [value]</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Maximum Qty Discount is Applied To:</strong> [cap]</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Discount Qty Step (Buy X):</strong> [for BXGY]</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Apply to Shipping Amount:</strong> [Yes/No]</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Free Shipping:</strong> [No | For matching items only | For shipment with matching items]</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Stop Further Rules Processing:</strong> [Yes/No]</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Conditions:</strong> [limit the products affected by the discount]</li>
                </ul>
                <p class="text-gray-700 text-sm mt-3"><strong>Note:</strong> "Apply to Shipping Amount" includes shipping in the discount calculation; it does not make shipping free. To make shipping free, set Free Shipping and enable the Free Shipping carrier under <span class="step-code">Stores &gt; Configuration &gt; Sales &gt; Shipping Methods &gt; Free Shipping</span>.</p>
            </div>

            <div>
                <p class="font-semibold text-charcoal mb-3">4) Labels</p>
                <p class="text-gray-700 text-sm">Default Rule Label for All Store Views and optional per-store view labels.</p>
            </div>

            <div>
                <p class="font-semibold text-charcoal mb-3">5) Save the rule.</p>
            </div>
        </div>

        <div class="bg-white border-4 border-yellow-500 p-4 mt-6">
            <div class="flex items-start gap-3">
                <svg class="w-5 h-5 text-orange-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                </svg>
                <div>
                    <p class="font-semibold text-charcoal mb-1">Tips</p>
                    <ul class="space-y-2 text-charcoal/80 text-sm">
                        <li class="relative pl-8 hexagon-bullet">Use the rule Priority and Stop Further Rules Processing to control stacking with other rules.</li>
                        <li class="relative pl-8 hexagon-bullet">Ensure Websites and Customer Groups selections match your intended audience.</li>
                        <li class="relative pl-8 hexagon-bullet">Scope: Rule Conditions = cart-level trigger. Actions &gt; Conditions = which items receive the discount.</li>
                        <li class="relative pl-8 hexagon-bullet">For configurable and bundle products, use Actions &gt; Conditions to target the specific items discounted (child SKUs). Rule-level Conditions evaluate the cart as a whole; Actions &gt; Conditions limit which items receive the discount.</li>
                        <li class="relative pl-8 hexagon-bullet">Bundles: For Dynamic Price bundles, discounts apply to child items; for Fixed Price bundles, discounts apply to the parent only. Configurables: Discounts are applied to the simple child selected at add-to-cart.</li>
                        <li class="relative pl-8 hexagon-bullet">Example: To discount only items in Category = Tees when the cart subtotal is over $100, put "Subtotal greater than 100" under Conditions (cart scope) and put "Category is Tees" under Actions &gt; Conditions (item scope).</li>
                        <li class="relative pl-8 hexagon-bullet">Adobe Commerce only: Save the rule, then open the Customer Segments tab on the rule to include/exclude segments (segments are created at <span class="step-code">Customers &gt; Segments</span>).</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Catalog Price Rules -->
    <div class="border-t-4 border-yellow-500 bg-white shadow-sm p-8 mb-6" id="catalog-price-rules">
        <h3 class="text-xl font-bold text-charcoal mb-4">Catalog Price Rules (Admin)</h3>
        <p class="text-gray-700 mb-4"><strong>Path:</strong> <span class="step-code">Admin &gt; Marketing &gt; Promotions &gt; Catalog Price Rules &gt; Add New Rule</span></p>

        <div class="space-y-6">
            <div>
                <p class="font-semibold text-charcoal mb-3">1) Rule Information</p>
                <p class="text-gray-700 text-sm">Name, Description, Websites, Customer Groups, From/To dates, Priority.</p>
            </div>

            <div>
                <p class="font-semibold text-charcoal mb-3">2) Conditions</p>
                <p class="text-gray-700 text-sm">Product attribute conditions (e.g., Category is 12; Attribute Set is "Shoes").</p>
            </div>

            <div>
                <p class="font-semibold text-charcoal mb-3">3) Actions</p>
                <ul class="space-y-2 text-gray-700 text-sm">
                    <li class="relative pl-8 hexagon-bullet"><strong>Apply:</strong> [Apply as percentage of original | Apply as fixed amount | Adjust final price to discount value | Adjust final price to this percentage]</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Discount Amount:</strong> [value]</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Stop Further Rules Processing:</strong> [Yes/No]</li>
                </ul>
            </div>

            <div>
                <p class="font-semibold text-charcoal mb-3">4) Labels</p>
                <p class="text-gray-700 text-sm">Default and per-store view labels.</p>
            </div>

            <div>
                <p class="font-semibold text-charcoal mb-3">5) Save and Apply</p>
                <ul class="space-y-2 text-gray-700 text-sm">
                    <li class="relative pl-8 hexagon-bullet">Click Save and Apply to rebuild rule index. Applying and scheduled activations require cron.</li>
                    <li class="relative pl-8 hexagon-bullet">Relevant indexers: <span class="step-code">catalogrule_rule</span> and <span class="step-code">catalogrule_product</span>. If needed, reindex via CLI: <span class="step-code">bin/magento indexer:reindex catalogrule_rule catalogrule_product</span></li>
                    <li class="relative pl-8 hexagon-bullet">Performance note: Applying Catalog Price Rules can trigger heavy indexing on large catalogs. Schedule updates during low-traffic windows and ensure cron frequency is adequate.</li>
                </ul>
            </div>
        </div>

        <div class="bg-white border-4 border-yellow-500 p-4 mt-6">
            <div class="flex items-start gap-3">
                <svg class="w-5 h-5 text-orange-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                </svg>
                <div>
                    <p class="font-semibold text-charcoal mb-1">Notes</p>
                    <ul class="space-y-2 text-charcoal/80 text-sm">
                        <li class="relative pl-8 hexagon-bullet">Catalog Price Rules adjust product prices before they enter the cart; no coupons are used.</li>
                        <li class="relative pl-8 hexagon-bullet">Price interactions: Catalog Price Rules are calculated from the Original (base) price. The storefront uses the lowest applicable price among: Special Price, Tier Price, Group Price (and Shared Catalog custom price in B2B), and the Catalog Rule adjusted price. "Stop Further Rules Processing" affects stacking with other Catalog Rules only; it does not prevent comparison against Special/Tier/Group/Shared Catalog prices.</li>
                        <li class="relative pl-8 hexagon-bullet">Special/Tier/Group prices can influence the resulting final price. Test outcomes on products that already have Special, Tier, or Group prices to confirm the intended result.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Coupons -->
    <div class="border-t-4 border-orange-500 bg-white shadow-sm p-8 mb-6" id="coupons">
        <h3 class="text-xl font-bold text-charcoal mb-4">Coupons</h3>
        <p class="text-gray-700 mb-4">Within a Cart Price Rule (<span class="step-code">Admin &gt; Marketing &gt; Promotions &gt; Cart Price Rules</span>):</p>

        <ul class="space-y-3 text-gray-700 mb-6">
            <li class="relative pl-8 leading-relaxed hexagon-bullet"><strong>Coupon:</strong> Select "Specific Coupon" to enable coupon fields.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet"><strong>Coupon Code:</strong> Enter a manual code OR set Use Auto Generation = Yes.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet"><strong>Manage Coupon Codes:</strong> After saving the rule, open it again and click Manage Coupon Codes to:
                <ul class="mt-2 ml-8 space-y-1 text-sm">
                    <li class="relative pl-8 hexagon-bullet">Generate: Specify Quantity, Code Length, Code Format, Prefix/Suffix, and Dash Every X Characters.</li>
                    <li class="relative pl-8 hexagon-bullet">Export: Download generated codes as CSV for marketing use.</li>
                </ul>
            </li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet"><strong>Strategy:</strong> Use auto-generated, unique single-use codes for influencer/affiliate channels to prevent leakage. Set Uses per Customer = 1 and Uses per Coupon = 1 for limited offers. For sitewide promos, use a generic code with strict end dates and priority settings.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet"><strong>Leakage control:</strong> For high-value offers, require login by targeting Customer Groups (exclude NOT LOGGED IN) and/or Customer Segments (Adobe Commerce). Pair with Uses per Customer = 1.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet"><strong>Tracking:</strong> <span class="step-code">Reports &gt; Sales &gt; Coupons</span> shows usage by rule and code.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet"><strong>Limitation:</strong> Only one coupon code can be applied to a cart at a time. Additional codes replace the existing one. Use rule Priority and Stop Further Rules Processing to control stacking with automatic (no-coupon) rules.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet">Ensure coupon codes are unique across all rules and websites. Duplicate codes in active rules can cause unexpected validation failures.</li>
        </ul>
    </div>

    <!-- Labels and Store Views -->
    <div class="border-t-4 border-yellow-500 bg-white shadow-sm p-8 mb-6" id="labels-store-views">
        <h3 class="text-xl font-bold text-charcoal mb-4">Labels and Store Views</h3>
        <ul class="space-y-2 text-gray-700">
            <li class="relative pl-8 leading-relaxed hexagon-bullet">Use clear, customer-friendly labels (e.g., "10% off orders $100+") under Labels.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet">Configure per-store view labels when wording should differ by locale or brand.</li>
        </ul>
    </div>

    <!-- Best-practice guardrails -->
    <div class="border-t-4 border-orange-500 bg-white shadow-sm p-8 mb-6" id="best-practice-guardrails">
        <h3 class="text-xl font-bold text-charcoal mb-4">Best-practice guardrails</h3>

        <ul class="space-y-3 text-gray-700 mb-6">
            <li class="relative pl-8 leading-relaxed hexagon-bullet">Set Uses per Coupon and Uses per Customer to prevent abuse.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet">Use Conditions in Actions to exclude low-margin or MAP-restricted products.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet">Prefer percent discounts over fixed amounts for mixed-price catalogs.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet">Cap Maximum Qty Discount is Applied To for BXGY and bulk discounts.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet">Use Priority and Stop Further Rules Processing to avoid unintended stacking.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet">Timebox promotions with From/To dates and review overlap.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet">Margin protection: Exclude low-margin SKUs or categories, prevent double-discounts by setting Stop Further Rules Processing = Yes on key rules, and avoid stacking with sitewide promotions.</li>
        </ul>

        <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4">
            <p class="font-semibold text-charcoal mb-2">Quick margin check example</p>
            <p class="text-gray-700 text-sm leading-relaxed">If your average gross margin is 40% and shipping subsidy per order is $5, on a $100 AOV order a 10% discount reduces revenue by $10. New gross margin dollars ≈ ($100 − $10) × 40% − $5 = $25. Compare this to baseline ($100 × 40% − $5 = $35). Adjust discount or threshold until post-discount margin dollars meet your target.</p>
        </div>
    </div>

    <!-- Test and Verify -->
    <div class="border-t-4 border-yellow-500 bg-white shadow-sm p-8 mb-6" id="test-verify">
        <h3 class="text-xl font-bold text-charcoal mb-4">Test and Verify</h3>

        <ul class="space-y-3 text-gray-700">
            <li class="relative pl-8 leading-relaxed hexagon-bullet">Create a test customer in each targeted customer group.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet">For Cart Price Rules: Add qualifying products; verify the discount and rule label appear in cart/checkout totals.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet">For Catalog Price Rules: After Save and Apply, confirm cron runs and, if needed, reindex via CLI; verify frontend prices reflect the discount. Note: Catalog rule labels are not rendered on the storefront by default and typically require theme customization.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet">Verify tax behavior: <span class="step-code">Stores &gt; Configuration &gt; Sales &gt; Tax &gt; Calculation Settings &gt; "Apply Discount On Prices"</span> (Excluding/Including Tax) matches policy.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet">Dates are inclusive and start at 00:00 store time. Cart and Catalog rules do not support time-of-day; to activate/deactivate at a specific hour, use Scheduled Updates (Adobe Commerce) or enable/disable the rule manually.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet">For multi-website setups: Test in each website/store view with its currency, validate rounding on catalog rule prices post currency conversion, and confirm tax settings per website (<span class="step-code">Stores &gt; Configuration &gt; Sales &gt; Tax</span>) match your discount calculation policy.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet">Multi-currency: Rule thresholds and calculations use the website base currency. Validate rounding and thresholds per website and storefront display currency.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet">With multiple rules, confirm Priority and Stop Further Rules Processing produce intended results.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet">Note: Apply to Shipping Amount does not make shipping free. It only includes shipping in the discount calculation. To make shipping free, use Actions &gt; Free Shipping.</li>
        </ul>
    </div>

    <!-- Reporting and Measurement -->
    <div class="border-t-4 border-yellow-500 bg-white shadow-sm p-8 mb-6" id="reporting-measurement">
        <h3 class="text-xl font-bold text-charcoal mb-4">Reporting and Measurement</h3>

        <ul class="space-y-3 text-gray-700 mb-6">
            <li class="relative pl-8 leading-relaxed hexagon-bullet"><strong>Coupons usage report:</strong> <span class="step-code">Admin &gt; Reports &gt; Sales &gt; Coupons</span>. Track redemptions, revenue, and AOV.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet"><strong>Key KPIs:</strong> redemption rate, incremental revenue, AOV lift, margin impact, and attach rate of promoted items.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet"><strong>For Catalog Rules without coupons:</strong> Compare period-over-period AOV and conversion on affected categories/SKUs, analyze cohorts during rule windows, and monitor margin impact.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet"><strong>Channel attribution:</strong> Tag campaigns (UTMs) and map orders to codes/channels to understand performance and reduce leakage. Combine coupon redemption data with order cohorts to isolate incremental lift versus baseline.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet">If your instance uses Report Statistics, go to <span class="step-code">Reports &gt; Statistics</span> and Refresh to ensure current data. Export coupon reports to CSV and join with UTM-tagged order data for channel-level ROI.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet">Name codes with campaign prefixes (e.g., IG-SUMMER10) and tag links with UTMs. This enables channel-level ROI in reports when you export coupon usage and join to order sources.</li>
            <li class="relative pl-8 leading-relaxed hexagon-bullet">Export report data to analyze performance by channel or code batch.</li>
        </ul>
    </div>

    <!-- API Quick Reference -->
    <div class="border-t-4 border-charcoal bg-white shadow-sm p-8 mb-6" id="api-quick-reference">
        <h3 class="text-xl font-bold text-charcoal mb-4">API Quick Reference (REST)</h3>

        <div class="bg-white shadow-sm overflow-hidden mb-6">
            <table class="w-full text-sm">
                <thead>
                    <tr class="bg-gray-100">
                        <th class="text-left px-6 py-3 font-semibold text-gray-900 border-b border-gray-200 w-2/5">Action</th>
                        <th class="text-left px-6 py-3 font-semibold text-gray-900 border-b border-gray-200">Endpoint</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-3 text-charcoal border-b border-gray-100">Apply coupon to customer cart</td>
                        <td class="px-6 py-3 text-gray-700 border-b border-gray-100"><span class="step-code">PUT /V1/carts/mine/coupons/{couponCode}</span></td>
                    </tr>
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-3 text-charcoal border-b border-gray-100">Remove coupon from customer cart</td>
                        <td class="px-6 py-3 text-gray-700 border-b border-gray-100"><span class="step-code">DELETE /V1/carts/mine/coupons</span></td>
                    </tr>
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-3 text-charcoal border-b border-gray-100">Apply coupon to guest cart</td>
                        <td class="px-6 py-3 text-gray-700 border-b border-gray-100"><span class="step-code">PUT /V1/guest-carts/{cartId}/coupons/{couponCode}</span></td>
                    </tr>
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-3 text-charcoal">Remove coupon from guest cart</td>
                        <td class="px-6 py-3 text-gray-700"><span class="step-code">DELETE /V1/guest-carts/{cartId}/coupons</span></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <ul class="space-y-2 text-gray-700 text-sm mb-6">
            <li class="relative pl-8 hexagon-bullet"><strong>Auth:</strong> <span class="step-code">/V1/carts/mine/*</span> endpoints require a customer token (<span class="step-code">Authorization: Bearer &lt;token&gt;</span>).</li>
            <li class="relative pl-8 hexagon-bullet"><strong>Guest flow:</strong> Create a cart via <span class="step-code">POST /V1/guest-carts</span> to obtain cartId, then call the guest coupon endpoints with that cartId.</li>
            <li class="relative pl-8 hexagon-bullet"><strong>Developer reference for SalesRule and CatalogRule endpoints:</strong> https://developer.adobe.com/commerce/webapi/rest/</li>
        </ul>

        <div class="bg-gray-50 p-4">
            <p class="font-semibold text-charcoal mb-2">GraphQL</p>
            <ul class="space-y-2 text-gray-700 text-sm">
                <li class="relative pl-8 hexagon-bullet"><strong>Apply coupon:</strong> <span class="step-code">mutation applyCouponToCart(input: { cart_id: "&lt;cartId&gt;", coupon_code: "&lt;code&gt;" }) { cart { applied_coupons { code } } }</span></li>
                <li class="relative pl-8 hexagon-bullet"><strong>Remove coupon:</strong> <span class="step-code">mutation removeCouponFromCart(input: { cart_id: "&lt;cartId&gt;" }) { cart { applied_coupons { code } } }</span></li>
                <li class="relative pl-8 hexagon-bullet"><strong>Docs:</strong> https://developer.adobe.com/commerce/webapi/graphql/</li>
            </ul>
        </div>
    </div>

    <!-- Troubleshooting -->
    <div class="border-t-4 border-orange-500 bg-white shadow-sm p-8 mb-6" id="troubleshooting">
        <h3 class="text-xl font-bold text-charcoal mb-4">Troubleshooting</h3>

        <div class="space-y-4">
            <div class="bg-white border-l-4 border-orange-500 p-6 shadow-sm">
                <p class="font-bold text-charcoal mb-2">Rule not applying</p>
                <p class="text-gray-700 leading-relaxed">Verify Websites and Customer Groups; ensure the cart meets both Conditions and Actions filters.</p>
            </div>

            <div class="bg-white border-l-4 border-orange-500 p-6 shadow-sm">
                <p class="font-bold text-charcoal mb-2">Coupon invalid</p>
                <p class="text-gray-700 leading-relaxed">Check From/To dates, Uses per Coupon/Customer limits, and code spelling/case.</p>
            </div>

            <div class="bg-white border-l-4 border-orange-500 p-6 shadow-sm">
                <p class="font-bold text-charcoal mb-2">Catalog Rule price not updated</p>
                <p class="text-gray-700 leading-relaxed">Click Save and Apply, confirm cron is running, reindex catalogrule_rule and catalogrule_product, then clear full-page cache. If storefront prices still do not reflect changes, purge Varnish/CDN and browser cache (<span class="step-code">System &gt; Tools &gt; Cache Management &gt; Flush Magento Cache</span>) and ensure your deployment purges external caches.</p>
            </div>

            <div class="bg-white border-l-4 border-orange-500 p-6 shadow-sm">
                <p class="font-bold text-charcoal mb-2">Discounts stacking unexpectedly</p>
                <p class="text-gray-700 leading-relaxed">Set Stop Further Rules Processing = Yes on the highest-priority rule.</p>
            </div>

            <div class="bg-white border-l-4 border-orange-500 p-6 shadow-sm">
                <p class="font-bold text-charcoal mb-2">Rule order</p>
                <p class="text-gray-700 leading-relaxed">Lower Priority number runs first. "Stop Further Rules Processing" stops only lower-priority rules after the current rule applies. If the rule doesn't apply, processing continues.</p>
            </div>

            <div class="bg-white border-l-4 border-orange-500 p-6 shadow-sm">
                <p class="font-bold text-charcoal mb-2">Tax discrepancy</p>
                <p class="text-gray-700 leading-relaxed">Review "Apply Discount On Prices" and "Apply to Shipping Amount" in Actions.</p>
            </div>
        </div>
    </div>

    <!-- Promotion Recipes -->
    <div class="border-t-4 border-yellow-500 bg-white shadow-sm p-8" id="promotion-recipes">
        <h3 class="text-xl font-bold text-charcoal mb-4">Promotion recipes (copy-ready examples)</h3>

        <div class="space-y-6">
            <div>
                <p class="font-bold text-charcoal mb-3">1) 10% off orders over $100 with coupon</p>
                <ul class="space-y-2 text-gray-700 text-sm">
                    <li class="relative pl-8 hexagon-bullet"><strong>Type:</strong> Cart Price Rule</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Rule Information:</strong> Coupon = Specific Coupon (e.g., SAVE10), Uses per Customer = 1, Priority = 1</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Conditions:</strong> Subtotal greater than 100</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Actions:</strong> Apply = Percent of product price discount; Discount Amount = 10; Apply to Shipping Amount = No; Stop Further Rules Processing = Yes</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Labels:</strong> "10% off $100+"</li>
                </ul>
            </div>

            <div>
                <p class="font-bold text-charcoal mb-3">2) Buy 2 get 1 free on Category "Tees"</p>
                <ul class="space-y-2 text-gray-700 text-sm">
                    <li class="relative pl-8 hexagon-bullet"><strong>Type:</strong> Cart Price Rule</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Rule Information:</strong> No Coupon; Priority = 1</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Conditions (Rule Conditions):</strong> [leave blank, or add cart-level limits as needed]</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Actions:</strong>
                        <ul class="mt-1 ml-8 space-y-1">
                            <li class="relative pl-8 hexagon-bullet">Apply = Buy X get Y (discount amount is Y)</li>
                            <li class="relative pl-8 hexagon-bullet">Discount Qty Step (Buy X) = 2</li>
                            <li class="relative pl-8 hexagon-bullet">Discount Amount (Y) = 1</li>
                            <li class="relative pl-8 hexagon-bullet">Maximum Qty Discount is Applied To = 0 (no limit) or set a cap as desired</li>
                            <li class="relative pl-8 hexagon-bullet">Actions &gt; Conditions: Category is Tees (ensures both X and Y items are from Tees)</li>
                        </ul>
                    </li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Labels:</strong> "Buy 2, get 1 free — Tees"</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Note:</strong> The free item is the lowest-priced matching item.</li>
                </ul>
            </div>

            <div>
                <p class="font-bold text-charcoal mb-3">3) 15% off Clearance for 7 days (Catalog)</p>
                <ul class="space-y-2 text-gray-700 text-sm">
                    <li class="relative pl-8 hexagon-bullet"><strong>Type:</strong> Catalog Price Rule</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Rule Information:</strong> From/To = [7-day window], Priority = 1</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Conditions:</strong> Product attribute "Clearance" = Yes (or Category = Clearance)</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Actions:</strong> Apply = By Percentage of the Original Price; Discount Amount = 15; Stop Further Rules Processing = Yes</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Labels:</strong> "15% off Clearance"</li>
                    <li class="relative pl-8 hexagon-bullet"><strong>Scheduling note:</strong> For staged activations with versioning, use Scheduled Updates (Adobe Commerce only).</li>
                </ul>
            </div>
        </div>
    </div>
</section>

<style>
/* Hexagon bullet marker for lists */
.hexagon-bullet::before {
    content: "";
    position: absolute;
    left: 0;
    top: 0.5em;
    width: 9px;
    height: 9px;
    background-image: url("data:image/svg+xml,%3Csvg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12 2L21 7V17L12 22L3 17V7L12 2Z' stroke='%23F26423' stroke-width='2.5' stroke-linejoin='miter'/%3E%3C/svg%3E");
    background-size: contain;
    background-repeat: no-repeat;
}

/* Step code styling for inline code paths */
.step-code {
    background: #2C2C2C;
    color: #F1BC1B;
    padding: 0.25rem 0.5rem;
    font-family: 'Courier New', monospace;
    font-size: 0.875rem;
}
</style>
