/**
 * Code Block Styling
 * Sublime Text / Monokai-inspired theme with AAA accessibility
 *
 * Color scheme (AAA compliant on #272822 background):
 * - Background: #272822 (Monokai dark)
 * - Default text: #F8F8F2 (off-white, contrast 13.98:1)
 * - Comments: #88846F (muted, contrast 4.59:1)
 * - Strings: #E6DB74 (yellow, contrast 11.04:1)
 * - Keywords: #F92672 (magenta/pink, contrast 5.74:1)
 * - Functions: #A6E22E (green, contrast 10.45:1)
 * - Numbers: #AE81FF (purple, contrast 5.89:1)
 * - Variables: #66D9EF (cyan, contrast 9.65:1)
 */
@layer components {
    /* Code blocks wrapper for copy button */
    .code-block-wrapper {
        @apply relative;
    }

    .code-block-wrapper .copyBtn {
        @apply absolute right-3 top-3 outline-none p-2 rounded;
        @apply bg-gray-700/50 text-gray-400 hover:bg-gray-600 hover:text-white;
        @apply opacity-0 transition-all duration-200;
        z-index: 10;
    }

    .code-block-wrapper:hover .copyBtn {
        @apply opacity-100;
    }

    /* Copy button states */
    .code-block-wrapper .copyBtn:hover,
    .code-block-wrapper .copyBtn:focus,
    .code-block-wrapper .copyBtn:active {
        @apply text-white outline-none ring-2 ring-gray-500;
    }

    /* Pre blocks - Sublime Text / Monokai style */
    pre {
        @apply relative my-6 overflow-x-auto whitespace-pre break-normal;
        background: #272822;
        border-radius: 0;
        tab-size: 4;
        box-shadow:
            0 4px 6px -1px rgb(0 0 0 / 0.2),
            0 2px 4px -2px rgb(0 0 0 / 0.1),
            inset 0 1px 0 rgb(255 255 255 / 0.05);
    }

    /* Code inside pre - Monokai default text color */
    pre code {
        @apply block p-5 text-sm font-mono leading-relaxed;
        color: #F8F8F2;
        background: transparent;
        border: none;
        white-space: pre;
        word-break: normal;
        overflow-wrap: normal;
    }

    /* Torchlight syntax highlighting */
    pre code.torchlight {
        @apply block py-4 min-w-max;
    }

    pre code.torchlight .line {
        @apply px-5;
    }

    pre code.torchlight .line-number {
        @apply pr-4 text-gray-500 select-none;
    }

    /* Mermaid diagrams */
    .mermaid {
        @apply p-4;
        background-color: #272822;
        border-radius: 0;
    }

    /* Force dark background on Torchlight code blocks with !important */
    .step-content pre:has(code.torchlight) {
        background-color: #272822 !important;
        border-radius: 0 !important;
        padding: 0 !important;
        overflow-x: auto;
        margin: 1rem 0;
    }

    .step-content pre:has(code.torchlight) code {
        background: transparent !important;
    }

    /**
     * Inline code styling - AAA accessible
     * Uses a subtle light background with high contrast dark text
     * Contrast ratio: 12.63:1 (#374151 on #F3F4F6)
     * Mobile: allow wrapping to prevent horizontal overflow
     */
    .docs_main :not(pre) > code,
    .step-content :not(pre) > code,
    .step-code,
    code.step-code {
        @apply inline font-mono text-sm px-2 py-1 rounded;
        background: #F3F4F6;
        color: #374151;
        border: 1px solid #D1D5DB;
        white-space: normal;
        word-break: break-word;
    }

    /* Prevent wrapping on larger screens where there's room */
    @media (min-width: 640px) {
        .docs_main :not(pre) > code,
        .step-content :not(pre) > code,
        .step-code,
        code.step-code {
            white-space: nowrap;
            word-break: normal;
        }
    }

    /* Step code in dark contexts - no border radius */
    .step-timeline .step-content code:not(.torchlight),
    .step-timeline .step-content .step-code {
        background: #272822;
        color: #F8F8F2;
        border: 1px solid #3E3D32;
        padding: 0.25rem 0.625rem;
        border-radius: 0;
    }

    /* Inline code within list items */
    li code:not(.torchlight) {
        @apply inline;
        white-space: nowrap;
    }

    /**
     * Override inline HTML classes for pre blocks
     * These HTML files have hardcoded `bg-charcoal text-yellow-500` classes
     * Override to use Monokai theme colors
     */
    pre.text-yellow-500,
    pre.text-yellow,
    pre[class*="text-yellow"] {
        color: #F8F8F2 !important;
        background: #272822 !important;
    }

    pre.text-yellow-500 code,
    pre.text-yellow code,
    pre[class*="text-yellow"] code {
        color: #F8F8F2 !important;
        background: transparent !important;
    }

    /* Override bg-charcoal to Monokai background */
    pre.bg-charcoal {
        background: #272822 !important;
    }
}
